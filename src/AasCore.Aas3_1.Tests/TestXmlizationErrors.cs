/*
 * This code has been automatically generated by aas-core-codegen.
 * Do NOT edit or append.
 */

using Aas = AasCore.Aas3_1;  // renamed

using Path = System.IO.Path;

using NUnit.Framework; // can't alias

namespace AasCore.Aas3_1.Tests
{
    public class TestXmlizationErrors
    {
        [Test]
        public void Test_error_on_unexpected_declaration()
        {
            string path = Path.Combine(
                Aas.Tests.Common.TestDataDir,
                "Xml",
                "Expected",
                "extension",
                "minimal.xml");

            var text = System.IO.File.ReadAllText(path, System.Text.Encoding.UTF8);

            // We assume no XML declarations in our test data.
            if (!text.StartsWith("<extension "))
            {
                throw new System.InvalidOperationException(
                    "We expect our test example in XML to start with '<extension ', "
                        + $"but it does not: {path}"
                );
            }

            text = (
                "<?xml version=\"1.0\" encoding=\"utf-8\"?>"
                    + text
            );

            using var stringReader = new System.IO.StringReader(
                text);

            using var xmlReader = System.Xml.XmlReader.Create(
                stringReader);

            // We intentionally do not call `MoveToContent` to test the error message.
            // This is a very common situation, see:
            // https://github.com/aas-core-works/aas-core3.0-csharp/issues/24

            string? message = null;

            try
            {
                Aas.Xmlization.Deserialize.ExtensionFrom(
                    xmlReader);
            }
            catch (Aas.Xmlization.Exception exception)
            {
                message = exception.Message;
            }

            if (message == null)
            {
                throw new AssertionException("Unexpected no exception");
            }
            Assert.AreEqual(
                "Unexpected XML declaration when reading an instance of " +
                "class Extension, as we expect the reader to be set at content " +
                "with MoveToContent at: the beginning",
                message);
        }
    }  // class TestXmlizationErrors
}  // namespace AasCore.Aas3_1.Tests

/*
 * This code has been automatically generated by aas-core-codegen.
 * Do NOT edit or append.
 */
